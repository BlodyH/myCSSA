{% extends 'myCSSAhub/component/_layout.html' %}

{% block pageTitle %}
商家信息
{% endblock %}

{% block ExtraHeader %}
<!-- bootstrap 4.x is supported. You can also use the bootstrap css 3.3.x versions -->
<!-- <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" crossorigin="anonymous"> -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-fileinput/4.5.1/css/fileinput.min.css" media="all" rel="stylesheet"
    type="text/css" />
<!-- if using RTL (Right-To-Left) orientation, load the RTL CSS file after fileinput.css by uncommenting below -->
<!-- link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-fileinput/4.5.1/css/fileinput-rtl.min.css" media="all" rel="stylesheet" type="text/css" /-->
<!-- the font awesome icon library if using with `fas` theme (or Bootstrap 4.x). Note that default icons used in the plugin are glyphicons that are bundled only with Bootstrap 3.x. -->
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" crossorigin="anonymous">
<!-- <script src="https://code.jquery.com/jquery-3.3.1.min.js" crossorigin="anonymous"></script> -->
<!-- piexif.min.js is needed for auto orienting image files OR when restoring exif data in resized images and when you
    wish to resize images before upload. This must be loaded before fileinput.min.js -->


{% endblock ExtraHeader %}
{% block pageContent %}


<div>商家原图片</div>
<center><img id="m_img" src="{{infos.merchant_image}}" alt="{{infos.merchant_name}}" width="350" height="170"></center>
<form method="post" id="form" enctype="multipart/form-data">
    {% for hidden_field in form.hidden_fields %}
        {{ hidden_field }}
    {% endfor %}

    {% if form.non_field_errors %}
    <div class="alert alert-danger" role="alert">
        {% for error in form.non_field_errors %}
        {{ error }}
        {% endfor %}
    </div>
    {% endif %}
    {% comment %} {% for error in form.non_field_errors %}
    <div class="alert alert-danger">
        <strong>{{ error|escape }}</strong>
    </div>
    {% endfor %} {% endcomment %}

    {% if update %}
    <div class="alert alert-success alert-dismissible fade show" role="alert">
        <strong>新商户信息已添加</strong>
        <div id="countdown" style="float:right;">3s后自动跳转</div>
        <button class="close" type="button" data-dismiss="alert" aria-label="Close">
            <span aria-hidden="true">×</span>
        </button>
    </div>

    <script type="text/javascript">

        var count = 3;
        //写一个方法，显示倒数秒数  数到0后跳转页面
        function countDown() {
            //将count显示在div中
            document.getElementById("countdown").innerHTML = count + 's后自动跳转';
            //没执行一次，count减1
            count -= 1;
            //count=0时，跳转页面
            if (count == 0) {
                location.href = '{% url 'myCSSAhub:merchants_list' %}';
                //window.location.href="index.html";
            }
            //每秒执行一次,showTime()
            setTimeout("countDown()", 1000);
        }
        //执行countDown方法
        countDown();
    </script>
    {% endif %}

    {% csrf_token %}
    <div class="form-group">
        <label for="merchant_name">商户名：</label>
        <input class="form-control" id="m_name" name="m_name" style="width:100%" required/>
        <label for="merchant_address">地址：</label>
        <input class="form-control" id="m_address" name="m_address" type="text" required />
        <label for="merchant_phone">联系电话：</label>
        <input class="form-control" id="m_phone" name="m_phone" type="phone"  />
        <label for="merchant_link">商家网站：</label>
        <input class="form-control" id="m_link" name="m_link" type="link"  />
        <div class="form-group">
            <label for="merchant_description">商家简介：</label>
            <textarea class="form-control" id="m_description" name="m_description" rows="11" required></textarea>
        </div>
        <div class="form-group">
            <label for="merchant_pic">选择商家图片：</label>
            <input id="input-b1" name="m_image" type="file" class="file" data-browse-on-zone-click="true">
        </div>
    </div>
    <!-- 直接点击submit可以发送ID至后台，select2控件已经封装好了 -->
    <button class="btn btn-primary" type="submit">发送</button>
    <button class="btn btn-danger" type="reset">删除</button>

</form>

{% endblock%}
{% block ExtraJS %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-fileinput/4.5.1/js/plugins/piexif.min.js" type="text/javascript"></script>
<!-- sortable.min.js is only needed if you wish to sort / rearrange files in initial preview.
    This must be loaded before fileinput.min.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-fileinput/4.5.1/js/plugins/sortable.min.js" type="text/javascript"></script>
<!-- purify.min.js is only needed if you wish to purify HTML content in your preview for
    HTML files. This must be loaded before fileinput.min.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-fileinput/4.5.1/js/plugins/purify.min.js" type="text/javascript"></script>

<!-- the main fileinput plugin file -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-fileinput/4.5.1/js/fileinput.min.js"></script>
<!-- following theme script is needed to use the Font Awesome 5.x theme (`fas`) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-fileinput/4.5.1/themes/fas/theme.min.js"></script>
<!-- optionally if you need translation for your language then include the locale file as mentioned below (replace LANG.js with your language locale) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-fileinput/4.5.1/js/locales/LANG.js"></script>

<script type="text/javascript">
    
    document.getElementById("m_name").value = '{{infos.merchant_name}}'
    document.getElementById("m_address").value = '{{infos.merchant_address}}'
    document.getElementById("m_phone").value = '{{infos.merchant_phone}}'
    document.getElementById("m_link").value = '{{infos.merchant_link}}'
    document.getElementById("m_description").value = '{{infos.merchant_description}}'
    //document.getElementById("input-b1").value = '{{infos.merchant_image}}'
</script>
{% endblock ExtraJS %}
