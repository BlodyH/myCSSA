{% extends 'components/base_page.html' %}

{% block 'pg_body' %}
{% load static %}



        
<div class="row">
      <div class="jumbotron jumbotron-fluid col-md-12" style="width:100%">
        <div class="container-fluid">
        <h1 class="display-3 text-center">摄影大赛报名</h1>
        </div>
        </div>
    </div>
    <div class="row">
            <div class="col-lg-9">
              <div id="ErrMsgArea">
        </div>
                {% if prev_submission %}
                <div class="card text-white bg-warning mb-3">
        <div class="card-header">你已经提交过该职位的申请</div>
        <div class="card-body">
          <p class="card-text">上次提交时间为：{{ prev_submission.timeOfCreate }}</p>
        </div>
    </div>
                {% endif %}
                </div>
    </div>



<div class="container bloc-fill-screen">
  <div class="row justify-content-center">
    <div class=" col-md-4 sticky-top" id="accordion">
      <div class="card sticky-top">
            <div class="card-header" id="headingOne">
            <h1><button class="btn btn-link" data-toggle="collapse" data-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                    <i class="fa fa-circle-o"></i><strong>  摄影大赛规则明细</strong>
                  </button></h1>
                  </div>
                  <div id="collapseOne" class="collapse show" aria-labelledby="headingOne" data-parent="#accordion">
                        <div class="card-body">
                                主题：<strong>我与墨尔本</strong>
                                <br><br>
                                手机组：全面征集与主题相关并用手机拍摄的摄影作品<br>
                                专业组：全面征集与主题相关并用专业设备，例如单反拍摄的摄影作品<br><br>
                                选手仅可投稿上述其中<strong>一种</strong>组别。两个组别设有两个类型，分别为人文类型和
                                风景类型。<br>
                                选手可以在投稿的组别中任意选择心仪的类型，每个类别只可上传<strong>最多一张</strong>摄影作品。
                                本次大赛上传的作品最大不可超过5兆。<br><br><strong>选手一旦上传照片，不可更改或者撤回。请选手务必审核之后在规定时间内通过官网提交。</strong>
                                <br><br>决赛阶段，CSSA将公开专设的投票链接。投票可通过网站，按照组别以及类型，为自己喜欢的作品投票，投票截止后根据票数评选获奖作品。
                                <br><br>本次比赛最终解释权归CSSA社团所有。                        
                            </div>
                      </div>
                    </div>
                    </div>

                    <div class="col-md-8">
                            <div class="card">
                              <div class="card-body justify-content-center text-center">
                                    <form id="main_form" method="POST" enctype="multipart/form-data">
                                        {% csrf_token %}
                                        {% load widget_tweaks %}
                                        {% for field in form %}
                                        <div class="form-group ">
                                            {% if field.name == "upload_photo" %}
                                            {{form.upload_photo.label_tag}}
                                            <input id="input-b1" name="attachment" type="file" class="file" data-browse-on-zone-click="true">
                                            {% else %}
                                               {{field.label_tag}}
                                                {% render_field field class="form-control" %}
                                                {% endif %}
                                                {% endfor %}
                                            </div>
                                                <div class='card-footer'>
                                                        <button class="btn btn-primary" type="submit"> 提交作品</button>
                                                    </div>
                                                    </form>
                                                    </div>
                                                    </div>
                    </div>
                    </div>
                   </div>
{% endblock 'pg_body' %}

{% block 'extra_js' %}

	<script type="text/javascript" src="https://unpkg.com/file-upload-with-preview"></script>
	<script type="text/javascript">
		{% if prev_submission %}
			$("#main_form :input").prop("disabled", true);

			$('#job-reason').val("{{ prev_submission.reason }}");
			$('#job-inSchoolExp').val("{{ prev_submission.inSchoolExp }}");
			$('#job-hobby').val("{{ prev_submission.hobby }}");
			$('#additionMsg').val("{{ prev_submission.message }}");
			$('#form-agreement').hide();
			$('#form-submit').hide();
		{% endif %}
		$('#form-agreement').on('click', function(){
			if ($('#form-agreement').prop('checked')){
			$('#form-submit').removeAttr('disabled')
			$('#form-submit').attr('class','btn btn-primary btn-lg btn-block')
			} else
			{
				$('#form-submit').attr('disabled','disabled')
				$('#form-submit').attr('class','btn btn-secondary btn-lg btn-block')
			}
		});

		function gotoParentPage(){
			window.location.href = "{% url 'PublicSite:recruitment' %}"
		}

		$('#main_form').on('submit', function(e){
			e.preventDefault();
			var formData = new FormData(this);
			$('#submit-loader').attr('class', 'loader loader-curtain is-active')
			$.ajax({
				url : window.location.href, // the endpoint
				type : "POST", // http method
				data : formData,
				processData:false,
				contentType:false,
				// handle a successful response
				success : function(json) {
					$('#submit-loader').attr('class', 'loader loader-curtain')
					if (json["result"]) {
						$('#myModal').modal('show');
					} else {
						$('#ErrMsgArea').html('<div id="login-fail-alert" class="alert alert-dismissible alert-warning fade show" role="alert"><button type="button" class="close" data-dismiss="alert">&times;</button><h4 class="alert-heading">表单验证失败！请检查您的输入</h4><p class="mb-0">'+errmsg+'</p></div>')
						console.log(json);
					}
				},
				// handle a non-successful response
				error : function(xhr,errmsg,err) {
					$('#submit-loader').attr('class', 'loader loader-curtain')
					$('#ErrMsgArea').html('<div id="login-fail-alert" class="alert alert-dismissible alert-warning fade show" role="alert"><button type="button" class="close" data-dismiss="alert">&times;</button><h4 class="alert-heading">服务器故障</h4><p class="mb-0">'+errmsg+'</p></div>')
					console.log(xhr.status + ": " + xhr.responseText); // provide a bit more info about the error to the console
					}
				});

			});
</script>


<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-fileinput/4.5.1/js/plugins/piexif.min.js" type="text/javascript"></script>
<!-- sortable.min.js is only needed if you wish to sort / rearrange files in initial preview.
    This must be loaded before fileinput.min.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-fileinput/4.5.1/js/plugins/sortable.min.js" type="text/javascript"></script>
<!-- purify.min.js is only needed if you wish to purify HTML content in your preview for
    HTML files. This must be loaded before fileinput.min.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-fileinput/4.5.1/js/plugins/purify.min.js" type="text/javascript"></script>

<!-- the main fileinput plugin file -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-fileinput/4.5.1/js/fileinput.min.js"></script>
<!-- following theme script is needed to use the Font Awesome 5.x theme (`fas`) -->

<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-fileinput/4.5.1/themes/fa/theme.min.js"></script>


<script>
	$("#input-b1").fileinput({
					theme: "fa",
	        allowedFileExtensions: ['pdf','doc'],
	        overwriteInitial: false,
					showUpload: false,
	        maxFileSize: 2048,
	        maxFilesNum: 1,
	        slugCallback: function (filename) {
	            return filename.replace('(', '_').replace(']', '_');
	        },
					{% if prev_submission %}
					initialPreview: [
						{% if prev_submission.attachment %}
								"{{ prev_submission.attachment.url }}"
						{% endif %}
						,		
					],
					initialPreviewAsData: true, 
					initialPreviewConfig:[
						 {type: "pdf", caption:'' ,key: 1}, ]
					{% endif %}
	    });
</script>

{% endblock 'extra_js' %}



